<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive DataTable Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/style/styles.css">
  <title>User Screen</title>
</head>
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom border-secondary border-opacity-25 rounded-bottom shadow">
    <div class="container-fluid">
        <a class="navbar-brand text-success" href="dashboard.html">
          <img src="logo2.png" alt="logo2" style="height: 30px;">
          RRMMS
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link text-dark" href="dashboard.html">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-dark" href="repair.html">Repair Request</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-dark" href="clerk.html">User Approval</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-dark" href="miv.html">MIV Request</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active text-success fw-bold" href="Userscreen.html">User Management</a>
                </li>
            </ul>
            <div class="d-flex align-items-center">
                <span id="username" class="me-2">Ahmed Hasan</span>
                <a class="text-dark" href="login.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="30" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
  </nav>
<body>
    <div class="container">
        <h3>Item Form</h3>
        <form id="contractor-form" action="/submit" method="POST">
            <table id="item-table">
                <thead>
                    <tr>
                        <th class="resizable">Serial Number</th>
                        <th class="resizable">Category</th>
                        <th class="resizable">Item</th>
                        <th class="resizable">Quantity</th>
                        <th class="resizable">Measuring Quantity</th>
                        <th class="resizable">Misc</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="serial-number">1</td>
                        <td>
                            <select class="category" onchange="updateItems(this)">
                                <option value="">Select Category</option>
                                <option value="Plumbing">Plumbing</option>
                                <option value="Carpentry">Carpentry</option>
                                <option value="Electrical">Electrical</option>
                                <option value="AC Fixing">AC Fixing</option>
                                <option value="Masonry">Masonry</option>
                                <option value="Painting">Painting</option>
                                <option value="Tiling">Tiling</option>
                                <option value="Roofing">Roofing</option>
                                <option value="Landscaping">Landscaping</option>
                                <option value="Pest Control">Pest Control</option>
                            </select>
                        </td>
                        <td>
                            <select class="item">
                                <option value="">Select Item</option>
                            </select>
                        </td>
                        <td><input type="number" class="quantity" min="1" /></td>
                        <td><input type="text" class="measuring-quantity" placeholder="e.g. meters, pieces" /></td>
                        <td><textarea class="misc" placeholder="e.g. notes"></textarea></td>
                        <td>
                            <button type="button" class="delete-btn">X</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="button" id="add-row-btn">+ Add Row</button>
            <div class="submit-btn-container">
                <button type="submit" class="submit-btn">Submit</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addRowBtn = document.getElementById('add-row-btn');
            const itemTable = document.getElementById('item-table').getElementsByTagName('tbody')[0];
            
            let serialNumber = 2;

            addRowBtn.addEventListener('click', () => {
                const newRow = itemTable.insertRow();
                
                newRow.innerHTML = `
                    <td class="serial-number">${serialNumber++}</td>
                    <td>
                        <select class="category" onchange="updateItems(this)">
                            <option value="">Select Category</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Carpentry">Carpentry</option>
                            <option value="Electrical">Electrical</option>
                            <option value="AC Fixing">AC Fixing</option>
                            <option value="Masonry">Masonry</option>
                            <option value="Painting">Painting</option>
                            <option value="Tiling">Tiling</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Landscaping">Landscaping</option>
                            <option value="Pest Control">Pest Control</option>
                        </select>
                    </td>
                    <td>
                        <select class="item">
                            <option value="">Select Item</option>
                        </select>
                    </td>
                    <td><input type="number" class="quantity" min="1" /></td>
                    <td><input type="text" class="measuring-quantity" placeholder="e.g. meters, pieces" /></td>
                    <td><textarea class="misc" placeholder="e.g. notes"></textarea></td>
                    <td>
                        <button type="button" class="delete-btn">X</button>
                    </td>
                `;
            });

            itemTable.addEventListener('click', (event) => {
                if (event.target.classList.contains('delete-btn')) {
                    event.target.closest('tr').remove();
                    // Recalculate serial numbers
                    let rows = itemTable.getElementsByTagName('tr');
                    serialNumber = 1;
                    for (let row of rows) {
                        row.getElementsByClassName('serial-number')[0].innerText = serialNumber++;
                    }
                }
            });
        });

        function updateItems(selectElement) {
            const row = selectElement.closest('tr');
            const itemSelect = row.querySelector('.item');
            const category = selectElement.value;

            let items = [];
            switch (category) {
                case 'Plumbing':
                    items = ['Pipe', 'Wrench', 'Faucet', 'Valve', 'Hose'];
                    break;
                case 'Carpentry':
                    items = ['Hammer', 'Nails', 'Saw', 'Wood Plank', 'Screwdriver'];
                    break;
                case 'Electrical':
                    items = ['Wire', 'Socket', 'Switch', 'Light Bulb', 'Fuse'];
                    break;
                case 'AC Fixing':
                    items = ['AC Unit', 'Thermostat', 'Filter', 'Coil Cleaner', 'Remote'];
                    break;
                case 'Masonry':
                    items = ['Brick', 'Cement', 'Mortar', 'Trowel', 'Block'];
                    break;
                case 'Painting':
                    items = ['Paint', 'Brush', 'Roller', 'Tape', 'Primer'];
                    break;
                case 'Tiling':
                    items = ['Tile', 'Grout', 'Adhesive', 'Tile Cutter', 'Spacers'];
                    break;
                case 'Roofing':
                    items = ['Shingle', 'Roofing Felt', 'Flashings', 'Gutter', 'Sealant'];
                    break;
                case 'Landscaping':
                    items = ['Soil', 'Plants', 'Mulch', 'Shovel', 'Rake'];
                    break;
                case 'Pest Control':
                    items = ['Pesticide', 'Trap', 'Bait', 'Repellent', 'Insecticide'];
                    break;
                default:
                    items = [];
                    break;
            }

            itemSelect.innerHTML = '<option value="">Select Item</option>';
            items.forEach(item => {
                itemSelect.innerHTML += `<option value="${item}">${item}</option>`;
            });
        }

//for sending values to db

document.getElementById('contractor-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission
    
    const tableRows = document.querySelectorAll('#item-table tbody tr');
    const formData = [];

    tableRows.forEach(row => {
        const rowData = {
            serialNumber: row.querySelector('.serial-number').innerText,
            category: row.querySelector('.category').value,
            item: row.querySelector('.item').value,
            quantity: row.querySelector('.quantity').value,
            measuringQuantity: row.querySelector('.measuring-quantity').value,
            misc: row.querySelector('.misc').value
        };
        formData.push(rowData);
    });

    // Send the data to the server
    fetch('/submit', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Data inserted successfully') {
            alert('Data added successfully!');
            // Optionally, reset the form or take other actions
        }
        console.log('Success:', data);
    })
    .catch((error) => {
        console.error('Error:', error);
    });
});


        // Column Resizing Logic
        document.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('resizable')) {
                const th = e.target;
                const startX = e.pageX;
                const startWidth = th.offsetWidth;

                const mouseMoveHandler = (e) => {
                    const newWidth = startWidth + (e.pageX - startX);
                    th.style.width = `${newWidth}px`;
                };

                const mouseUpHandler = () => {
                    document.removeEventListener('mousemove', mouseMoveHandler);
                    document.removeEventListener('mouseup', mouseUpHandler);
                };

                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);
            }
        });
    </script>
</body>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
    }

    .container {
        max-width: 1200px;
        margin: auto;
    }

    h3 {
        text-align: center;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        position: relative;
    }

    table, th, td {
        border: 1px solid #ddd;
    }

    th, td {
        padding: 8px;
        text-align: left;
        position: relative;
    }

    th {
        background-color: #f4f4f4;
    }

    th.resizable {
        position: relative;
    }

    th.resizable::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 5px;
        height: 100%;
        cursor: col-resize;
        background-color: #ddd;
    }

    input[type="number"], input[type="text"], textarea {
        width: 100%;
        box-sizing: border-box;
    }

    .misc {
        min-height: 40px;
        resize: none; /* Disable manual resizing */
    }

    button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }

    .delete-btn {
        background-color: #dc3545;
    }

    .delete-btn:hover {
        background-color: #c82333;
    }

    .submit-btn-container {
        text-align: center;
        margin-top: 20px;
    }

    .submit-btn {
        background-color: #28a745;
        padding: 10px 20px;
        font-size: 16px;
    }

    .submit-btn:hover {
        background-color: #218838;
    }
    @media (max-width: 768px) {
        table thead {
            display: none;
        }

        table, table tbody, table tr, table td {
            display: block;
            width: 100%;
        }

        table tr {
            margin-bottom: 15px;
        }

        table td {
            text-align: center;
            padding-left: 1%;
            position: relative;
        }

        table td::before {
            content: attr(data-label);
            position: absolute;
            left: 0;
            width: 50%;
            padding-left: 15px;
            text-align: left;
            font-weight: bold;
            white-space: nowrap;
        }
    }
</style>
</html>
