<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="/style/styles.css">
  <title>Dashboard</title>
</head>

<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom border-secondary border-opacity-25 rounded-bottom shadow" style="padding: 0px 0rem;">

  <div class="container-fluid">
      <a class="navbar-brand text-success" href="dashboard.html">
        <img src="logo2.png" alt="logo2" style="height: 30px;">
        RRMMS
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                  <a class="nav-link active text-success fw-bold" href="dashboard.html">Dashboard</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link text-dark" href="repair.html">Repair Request</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link text-dark" href="clerk.html">User Approval</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link text-dark" href="miv.html">MIV Request</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link text-dark" href="Userscreen.html">User Management</a>
              </li>
          </ul>
          <div class="d-flex align-items-center">
              <span id="username" class="me-2 text-nowrap">Ahmed Hasan</span>
              <a class="text-dark" href="login.html">
                  <svg xmlns="http://www.w3.org/2000/svg" width="25" height="30" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                      <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                  </svg>
              </a>
          </div>
      </div>
  </div>
</nav>

<body>
  <div class="container mt-3">
    <h3>Welcome to RRMMS</h3>

    <!-- Filters -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="statusFilter" class="form-label">Status:</label>
        <select id="statusFilter" class="form-select" onchange="fetchStatusCount()">
          <option value="">All</option>
          <option value="Approved">Approved</option>
          <option value="Rejected">Rejected</option>
          <option value="Resolved">Resolved</option>
          <option value="Pending">Pending</option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="natureOfRequest" class="form-label">Nature of Request:</label>
        <select id="natureOfRequest" class="form-select" onchange="fetchStatusCount()">
          <option value="">All</option>
          <option value="Plumbing">Plumbing</option>
          <option value="Refrigerator/AC">Refrigerator/AC</option>
          <option value="Masonry">Masonry</option>
          <option value="Telephone">Telephone</option>
          <option value="Carpentry">Carpentry</option>
          <option value="Electricity">Electricity</option>
          <option value="Flooring">Flooring</option>
          <option value="Pest Control">Pest Control</option>
          <option value="Civil">Civil</option>
          <option value="Miscellaneous">Miscellaneous</option>
          <option value="Security System Installation">Security System Installation</option>
          <option value="Gardening">Gardening</option>
          <option value="Gutter">Gutter</option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="startDate" class="form-label">Start Date:</label>
        <input type="date" id="startDate" class="form-control" onchange="fetchStatusCount()">
      </div>
      <div class="col-md-3">
        <label for="endDate" class="form-label">End Date:</label>
        <input type="date" id="endDate" class="form-control" onchange="fetchStatusCount()">
      </div>
    </div>

    <!-- Status Counts Display -->
    <div class="row mb-3">
      <div class="col-12 col-md-10 mx-auto">
        <canvas id="myChart" class="" height="200"></canvas>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Status</th>
                <th>Plumbing</th>
                <th>Refrigerator/AC</th>
                <th>Masonry</th>
                <th>Telephone</th>
                <th>Carpentry</th>
                <th>Electricity</th>
                <th>Flooring</th>
                <th>PestControl</th>
                <th>Civil</th>
                <th>Miscellaneous</th>
                <th>Security</th>
                <th>Gardening</th>
                <th>Gutter</th>
              </tr>
            </thead>
            <tbody id="statusTableBody">
              <!-- Table rows will be inserted here by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function fetchStatusCount() {
      try {
        const status = document.getElementById('statusFilter').value;
        const natureOfRequest = document.getElementById('natureOfRequest').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        const query = new URLSearchParams({
          status: status,
          nature: natureOfRequest,
          startDate: startDate,
          endDate: endDate
        });

        const response = await fetch(`http://localhost:3000/status-count?${query.toString()}`);
        const data = await response.json();

        // Update chart data
        chartInstance.data.datasets[0].data = [
          data.Plumbingno,
          data.RefrigeratorACno,
          data.Masonryno,
          data.Telephoneno,
          data.Carpentryno,
          data.Electricityno,
          data.Flooringno,
          data.Pestno,
          data.Civilno,
          data.Miscellaneousno,
          data.Securityno,
          data.Gardeningno,
          data.Gutterno
        ];
        chartInstance.update();

        // Update table data
        const tableBody = document.getElementById('statusTableBody');
        tableBody.innerHTML = `
          <tr><td>Approved</td><td>${data.PlumbingApproved}</td><td>${data.RefrigeratorACApproved}</td><td>${data.MasonryApproved}</td><td>${data.TelephoneApproved}</td><td>${data.CarpentryApproved}</td><td>${data.ElectricityApproved}</td><td>${data.FlooringApproved}</td><td>${data.PestApproved}</td><td>${data.CivilApproved}</td><td>${data.MiscellaneousApproved}</td><td>${data.SecurityApproved}</td><td>${data.GardeningApproved}</td><td>${data.GutterApproved}</td></tr>
          <tr><td>Rejected</td><td>${data.PlumbingRejected}</td><td>${data.RefrigeratorACRejected}</td><td>${data.MasonryRejected}</td><td>${data.TelephoneRejected}</td><td>${data.CarpentryRejected}</td><td>${data.ElectricityRejected}</td><td>${data.FlooringRejected}</td><td>${data.PestRejected}</td><td>${data.CivilRejected}</td><td>${data.MiscellaneousRejected}</td><td>${data.SecurityRejected}</td><td>${data.GardeningRejected}</td><td>${data.GutterRejected}</td></tr>
          <tr><td>InProgess</td><td>${data.PlumbingResolved}</td><td>${data.RefrigeratorACResolved}</td><td>${data.MasonryResolved}</td><td>${data.TelephoneResolved}</td><td>${data.CarpentryResolved}</td><td>${data.ElectricityResolved}</td><td>${data.FlooringResolved}</td><td>${data.PestResolved}</td><td>${data.CivilResolved}</td><td>${data.MiscellaneousResolved}</td><td>${data.SecurityResolved}</td><td>${data.GardeningResolved}</td><td>${data.GutterResolved}</td></tr>
          <tr><td>Pending</td><td>${data.PlumbingPending}</td><td>${data.RefrigeratorACPending}</td><td>${data.MasonryPending}</td><td>${data.TelephonePending}</td><td>${data.CarpentryPending}</td><td>${data.ElectricityPending}</td><td>${data.FlooringPending}</td><td>${data.PestPending}</td><td>${data.CivilPending}</td><td>${data.MiscellaneousPending}</td><td>${data.SecurityPending}</td><td>${data.GardeningPending}</td><td>${data.GutterPending}</td></tr>
        `;
      } catch (error) {
        console.error('Error fetching status count:', error);
        document.getElementById('statusCount').textContent = 'Failed to load status count.';
      }
    }

    const ctx = document.getElementById('myChart').getContext('2d');
const chartInstance = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ["Plumbing", "Refrigerator/AC", "Masonry", "Telephone", "Carpentry", "Electricity", "Flooring", "Pest Control", "Civil", "Miscellaneous", "Security", "Gardening", "Gutter"],
    datasets: [{
      label: 'Count',
      data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // initial data
      backgroundColor: [
      'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)'


      ],
      borderColor: [
        'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)',
'rgba(128, 128, 128, 1)'

      ],
      borderWidth: 1
    }]
  },
  options: {
    plugins: {
      legend: {
        display: false
      }
    },
    responsive: true,
                tooltips: {
                    enabled: false,
                },
                barThickness: 20,
                maintainAspectRatio: false,

    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          font: {
            size: 10  // Smaller font size for y-axis labels
          }
        }
      },
      x: {
        ticks: {
          font: {
            size: 6  // Smaller font size for x-axis labels
          }
        },
        barPercentage: 1,       // Adjusts the width of the bars
        categoryPercentage: 1,  // Adjusts the space between bars
      }
    }
  }
});

    fetchStatusCount(); // Fetch data on page load
  </script>
</body>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 0;
        font-size: 12px;
    }
    .chart-container {
  width: 100%;
  height: 300px; /* Adjusted height to make the chart smaller */
  margin: 0 auto;
}
    .chart-container canvas {
        width: 80% ; /* Ensure canvas is 100% of the container */
        height: 300px !important;  /* Adjust the height as needed */
    }
   
    .table thead tr th {
        background-color:#6cb444;
        cursor: pointer;
    }

    .table {
    width: 100%;
    border-collapse: collapse;
    height: 100px;
}


.table tbody tr:nth-child(odd) {
    background-color: #80d419;
}

.table td, 
.table th {
    padding: 3px;
    text-align: center;
    vertical-align: middle;
    font-size: 12px;
    white-space: nowrap;
}

.form-select, .form-control {
    height: 30px; /* Adjust the height */
    padding: 4px 8px; /* Adjust the padding */
    font-size: 12px; /* Adjust the font size */
}

</style>
</html>